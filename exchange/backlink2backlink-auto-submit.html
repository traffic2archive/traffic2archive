<div id="stealthIFrameContainer"></div>
<script>
/* Instrumented version of your script â€” paste in place of old script */
const fetchData = [
  "https://smartbacklinkmaker.blogspot.com/"
];
const fetchURLs = [
  "https://backlink-generator-tool.github.io/url-dump-json/url/custom-urls/backlink-generator.json"
];
const WAYBACK_SAVE_ENDPOINTS = [
      "https://web.archive.org/save"
     
      //"https://web.archive.org/save",
      //"https://web.archive.org/",
      //"https://web.archive.org/web/*/",
      //"https://web.archive.org/web/"
  ];
const IFRAME_COUNT = 4;
const SUBMIT_INTERVAL = 60000;

function isValidURL(url) {
  const pattern = /^https?:\/\/[^\s]+$/i;
  return pattern.test(url);
}
function shuffle(array){ for(let i=array.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[array[i],array[j]]=[array[j],array[i]];} }
function normalizeURL(url){ if(typeof url!=='string') return ""; return url.replace(/([^:]\/)\/+/g,"$1"); }
function randomURL(array){ return array[Math.floor(Math.random()*array.length)]; }

async function updateDefaultURLs() {
  shuffle(fetchURLs);
  for (const u of fetchURLs) {
    try {
      console.log("ðŸ”Ž Trying to fetch URL list from:", u);
      const r = await fetch(u);
      if (!r.ok) throw new Error("HTTP " + r.status);
      const data = await r.json();
      if (Array.isArray(data) && data.length) {
        fetchData.length = 0;
        fetchData.push(...data);
        console.log("âœ… Loaded", data.length, "URLs from", u);
        return;
      }
    } catch (err) {
      console.warn("âš  Failed to load", u, err && err.message);
    }
  }
  console.warn("âš  Using fallback URLs:", fetchData.length);
}

function generateTargetURL() {
  if (!fetchData.length) return "";
  const url1 = randomURL(fetchData);
  const url2 = randomURL(fetchData);
  const combined = url1 + "?" + url2;
  return normalizeURL(combined);
}

function submitToWaybackInFrame(iframe) {
  try {
    const targetUrl = generateTargetURL();
    if (!targetUrl || !isValidURL(targetUrl)) {
      console.warn("âš  Skipping invalid target:", targetUrl);
      return;
    }
    const form = document.createElement("form");
    form.style.display = "none";
    form.target = iframe.name;
    form.method = "POST";
    form.action = randomURL(WAYBACK_SAVE_ENDPOINTS);
    form.className = "web-save-form";
    const input = document.createElement("input");
    input.type = "hidden";
    input.name = "url";
    input.value = targetUrl;
    form.appendChild(input);
    document.body.appendChild(form);

    console.log("ðŸ“¨ Submitting to Wayback in frame:", iframe.name, "target URL:", targetUrl);
    form.submit();

    // remove after a short delay to be safe
    setTimeout(() => {
      try { form.remove(); } catch(e) { /* ignore */ }
    }, 1000);
  } catch (err) {
    console.error("âŒ submitToWaybackInFrame error:", err);
  }
}

function createIframe(i) {
  try {
    const iframe = document.createElement("iframe");
    const fname = "hiddenFrame" + i;
    iframe.setAttribute("name", fname);
    iframe.setAttribute("id", fname);
    iframe.classList.add("hidden-iframe");
    // make it visible for debugging â€” remove border later if you want hidden
    iframe.style.width = "100%";
    iframe.style.height = "200px";
    iframe.style.border = "2px dashed red"; // debug border â€” remove or change to display:none if desired
    iframe.src = "about:blank";

    const container = document.getElementById("stealthIFrameContainer");
    container.appendChild(iframe);

    // wait a little so iframe is attached, then submit
    setTimeout(() => submitToWaybackInFrame(iframe), 250);

    setInterval(() => {
      console.log("â± Interval firing for iframe:", fname);
      submitToWaybackInFrame(iframe);
    }, SUBMIT_INTERVAL);
  } catch (err) {
    console.error("âŒ createIframe error:", err);
  }
}

/* Ensure container exists (defensive) */
if (!document.getElementById("stealthIFrameContainer")) {
  const c = document.createElement("div");
  c.id = "stealthIFrameContainer";
  document.body.appendChild(c);
  console.log("âž• Created missing stealthIFrameContainer.");
}

/* Run startup after DOM ready */
document.addEventListener('DOMContentLoaded', async () => {
  try {
    await updateDefaultURLs();
  } catch (e) {
    console.warn("updateDefaultURLs() failed:", e && e.message);
  }

  for (let i = 0; i < IFRAME_COUNT; i++) createIframe(i);
});
</script>
